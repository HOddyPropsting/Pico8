pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
-- snek
-- by henry oddy-propsting

-- 0=⬅️,1=➡️,2=⬆️,3=⬇️

snek = {
  x=8
, y=8
, d=0
, tail = {{x=9,y=8,d=0}}
}

game_over = false
t_next_step = 30
max_t_next_step = 10
next_d = 0

function get_random_free_spot()
 free_spots = {}
 for x=1,15 do
  for y=1,15 do
   can_add = true
   if snek.x == x and snek.y == x then
    break
   end
   if mget(x,y) != 0 then
    break
   end
   for t in all(snek.tail) do
    if t.x == x and t.y == y then
     can_add = false
    end
   end
   if can_add then
    add(free_spots,{x,y})
   end
  end
 end
 return free_spots[flr(rnd(#free_spots))+1]
end

function head_sprite()
 d = snek.d
 if d == 0 then
  spr(5,snek.x*8,snek.y*8)
 elseif d == 1 then
  spr(5,snek.x*8,snek.y*8,1,1,true)
 elseif d == 2 then
  spr(6,snek.x*8,snek.y*8)
 elseif d == 3 then
	 spr(6,snek.x*8,snek.y*8,1,1,false,true)
 end
end

function draw_tail()
 rt = {}
 for i=#snek.tail,1,-1 do
  add(rt,snek.tail[i])
 end


 for i,tail in pairs(rt) do
  -- if you are the last piece
  if i == #snek.tail then
   if tail.d == 0 then spr(4,tail.x*8,tail.y*8) end
   if tail.d == 1 then spr(10,tail.x*8,tail.y*8) end
   if tail.d == 2 then spr(3,tail.x*8,tail.y*8) end
   if tail.d == 3 then spr(9,tail.x*8,tail.y*8) end
  else
   pd = rt[i+1].d
   sp = 0
   if tail.d == 0 then
    if pd == 2 then sp = 13
    elseif pd == 3 then sp = 7
    else sp = 1 
    end
   elseif tail.d == 1 then
    if pd == 2 then sp = 12
    elseif pd == 3 then sp = 11
    else sp = 1
    end
   elseif tail.d == 2 then
    if pd == 0 then sp = 11 
    elseif pd == 1 then sp = 7
    else sp = 2 
    end
   elseif tail.d == 3 then
    if pd == 0 then sp = 12 
    elseif pd == 1 then sp = 13
    else sp = 2
    end
   end
   spr(sp,tail.x*8,tail.y*8)
  end  
 end
end

function _draw()
 cls()
	map(0,0)
 head_sprite()
 draw_tail()
end

function _update60()

 if game_over then
  if btnp(4) or btnp(5) then
   game_over = false
   snek = { x=8
          , y=8
          , d=0
          , tail = {{x=9,y=8,d=0}}
          }
   next_d = 0
  end
  return
 end

 if btnp(0) and snek.d != 1 then next_d = 0 end
 if btnp(1) and snek.d != 0 then next_d = 1 end
 if btnp(2) and snek.d != 3 then next_d = 2 end
 if btnp(3) and snek.d != 4 then next_d = 3 end
 
 t_next_step -= 1
 
 if t_next_step < 1 then
  next_x = snek.x
  next_y = snek.y
  snek.d = next_d
 	t_next_step = max_t_next_step
 	if snek.d == 0 then next_x = snek.x-1 end
 	if snek.d == 1 then next_x = snek.x+1 end
 	if snek.d == 2 then	next_y = snek.y-1 end
 	if snek.d == 3 then next_y = snek.y+1 end 
 	for tail in all(snek.tail) do
 	 if tail.x == next_x and tail.y == next_y then
 		 game_over = true
	 	 return
 	 end
 	end
 	if fget(mget(next_x,next_y),0) then
 	 game_over = true
 	 return
 	end
 	if fget(mget(next_x,next_y),2) then
	  mset(next_x,next_y,0)
	  new_loc = get_random_free_spot()
	  nl = new_loc
	  mset(new_loc[1],new_loc[2],14)
 	else
 	 del(snek.tail,snek.tail[1])
 	end
 	add(snek.tail,{x=snek.x,y=snek.y,d=snek.d})
 	snek.x = next_x
 	snek.y = next_y
	end
end
__gfx__
00000000000000000b3b3bb00b3b3bb00000000000000000000000000b3b3bb05555555500000000000000000bb3b3b000000000000000000000040000000040
00000000bbbbbbbb0bb3b3b00bb3b3b0bbbb00000bbbbbbb0b7007b0b3b3b3b054454454000bb000000bbbbb0b3b3bbb0bbbbbbbbbbbbbb000bb4b0000000aa0
007007003b3b3b3b0b3b3bb00b3b3bb03b3bb000070b83b30b0000b03b3b3bb05555555500bb3b0000b3b3b30bb3b3b30bbb3b3b3b3bbbb00bbbbbb000000aa0
00077000b3b3b3b30bb3b3b00bb3b3b0b3b3bb0000073b3b0b707bb0b3b3b3b0454454450bb3b3b00b3b3b3b0b3b3b3b0bb3b3b3b3b3bbb00bbbbbb00000aaa0
000770003b3b3b3b0b3b3bb000bb3b003b3b3b000000b3b30b3b38b03b3b3bb0555555550b3b3bb00bb3b3b30bb3b3b30b3b3b3b3b3b3bb00bbbbbb0000aaaa0
00700700b3b3b3b30bb3b3b0000bb000b3b3b00007073b3b0bb3b3b0b3b3b3b0544544540bb3b3b000bb3b3b0bbb3b3b0bb3b3b3b3b3b3b000bbbb000aaaaa00
00000000bbbbbbbb0b3b3bb000000000bbbb00000bbbbbbb0b3b3bb0bbbbbbb0555555550b3b3bb0000bbbbb0bbbbbbb0b3b3bbbbb3b3bb0000000000aaaa000
00000000000000000bb3b3b00000000000000000000000000bb3b3b000000000454454450bb3b3b000000000000000000bb3b3b00bb3b3b00000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000e0400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00ee4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00eeee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00044000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00044000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000010000000000040404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0808080808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0800000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0800000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0800000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0800000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0800000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0800000000000000000000000e00000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0800000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0800000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0800000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0800000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0800000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0800000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0800000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0800000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
